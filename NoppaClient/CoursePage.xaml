<phone:PhoneApplicationPage
    x:Class="NoppaClient.CoursePage"
    x:Name="Root"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:view="clr-namespace:NoppaClient.View"
    d:DataContext="{d:DesignData SampleData/CourseViewModelSampleData.xaml}"
    mc:Ignorable="d"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    SupportedOrientations="Portrait"  Orientation="Portrait"
    shell:SystemTray.IsVisible="True">

    <phone:PhoneApplicationPage.Resources>
        <ResourceDictionary x:Name="Resources">
            
            <view:OpenBrowserCommand x:Key="OpenBrowserCommand" />

            <DataTemplate x:Key="LectureTemplate">
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding Date}"/>
                        <TextBlock Text=" " />
                        <TextBlock Text="{Binding StartTime}" />
                        <TextBlock Text="-" />
                        <TextBlock Text="{Binding EndTime}" />
                        <TextBlock Text=" " />
                        <TextBlock Text="{Binding Location}" />
                        <TextBlock Text=" " />
                    </StackPanel>
                    <TextBlock Text="{Binding Title}" />
                    <ItemsControl ItemsSource="{Binding Materials}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="22,0,22,10">
                                    <Button Content="{Binding Title}" Command="{StaticResource OpenBrowserCommand}" CommandParameter="{Binding Url}" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="NewsItemTemplate">
            <StackPanel Margin="0,0,0,0">
                <TextBlock Text="{Binding Title}" Style="{StaticResource PhoneTextTitle2Style}" TextWrapping="Wrap" />
                <TextBlock Text="{Binding Date}" Style="{StaticResource PhoneTextSubtleStyle}" />
                <TextBlock Text="{Binding Content}" Style="{StaticResource PhoneTextNormalStyle}" TextWrapping="Wrap" />
                <!-- Use ItemsControl here so that items are laid out inline, and not in a scroll area -->
                <ItemsControl ItemsSource="{Binding Links}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="22,0,22,10">
                                <Button Content="{Binding Title}" Command="{StaticResource OpenBrowserCommand}" CommandParameter="{Binding Url}" />
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </StackPanel>
        </DataTemplate>

        <!-- Templates for the Pivot view models -->
        <ResourceDictionary x:Key="ViewModelTemplates">
            <DataTemplate x:Key="FrontPageViewModel">
                <ScrollViewer HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <StackPanel>
                        <TextBlock Text="{Binding Code}" />
                    </StackPanel>
                </ScrollViewer>
            </DataTemplate>

            <DataTemplate x:Key="OverviewViewModel">
                <ScrollViewer HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <StackPanel>
                        <TextBlock Text="Overview" />
                        <TextBlock Text="{Binding CourseId}" />
                        <TextBlock Text="{Binding Credits}" />
                        <TextBlock Text="{Binding Status}" />
                        <TextBlock Text="{Binding Level}" />
                        <TextBlock Text="{Binding TeachingPeriod}" />
                        <TextBlock Text="{Binding Workload}" />
                        <TextBlock Text="{Binding LearningOutcomes}" />
                        <TextBlock Text="{Binding Content}" />
                        <TextBlock Text="{Binding Assessment}" />
                        <TextBlock Text="{Binding StudyMaterial}" />
                        <TextBlock Text="{Binding GradingScale}" />
                        <TextBlock Text="{Binding InstructionLanguage}" />
                        <TextBlock Text="{Binding Details}" />
                        <TextBlock Text="{Binding OodiUrl}" />
                        <TextBlock Text="{Binding Substitutes}" />
                        <TextBlock Text="{Binding CEFRLevel}" />
                        <TextBlock Text="{Binding Registration}" />
                        <TextBlock Text="{Binding Staff}" />
                        <TextBlock Text="{Binding OfficeHours}" />
                        <Button Content="Open in Noppa"  Command="{Binding OpenNoppaPage}" />
                        <Button Content="Open in Oodi"  Command="{Binding OpenOodiPage}" />
                    </StackPanel>
                </ScrollViewer>
            </DataTemplate>

            <DataTemplate x:Key="NewsViewModel">
                <ListBox
                    Margin="0,0,-22,0"
                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                    ItemTemplate="{StaticResource NewsItemTemplate}"
                    ItemsSource="{Binding News}">
                </ListBox>
            </DataTemplate>

            <DataTemplate x:Key="LecturesViewModel">
                <ListBox x:Name="LectureList"
                    Margin="0,0,-22,0"
                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                    ItemTemplate="{StaticResource LectureTemplate}"
                    ItemsSource="{Binding Lectures}">
                </ListBox>
            </DataTemplate>

            <DataTemplate x:Key="ExercisesViewModel">
                <TextBlock Text="Exercies" />
            </DataTemplate>
        </ResourceDictionary>
            
        <!-- Misc. content -->
        <view:TypeNameToDataTemplateConverter x:Key="TypeNameToDataTemplateConverter" />
        <view:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <view:EnumerableIndexConverter x:Key="EnumerableIndexConverter" />
        <view:DesignToolChecker x:Key="DesignToolChecker" />
        </ResourceDictionary>
    </phone:PhoneApplicationPage.Resources>
    
    <!--LayoutRoot is the root grid where all page content is placed-->
    <Grid x:Name="LayoutRoot" Background="Transparent">
        <!-- Runtime Pivot Control -->
        <phone:Pivot Title="{Binding Path=LocalizedResources.ApplicationTitle, Source={StaticResource LocalizedStrings}}"
                     ItemsSource="{Binding Contents}"
                     Visibility="{Binding IsNotInDesignTool, Source={StaticResource DesignToolChecker}, Converter={StaticResource BooleanToVisibilityConverter}}">
            <phone:Pivot.ItemTemplate>
                <DataTemplate>
                    <view:DataTemplateSelector Content="{Binding}" TemplateDictionary="{StaticResource ViewModelTemplates}" />
                </DataTemplate>
            </phone:Pivot.ItemTemplate>
            <phone:Pivot.HeaderTemplate>
                <DataTemplate>
                    <Grid>
                        <TextBlock TextWrapping="Wrap" Text="{Binding Title}" />
                    </Grid>
                </DataTemplate>
            </phone:Pivot.HeaderTemplate>
        </phone:Pivot>

        <!-- 
            Design time Pivot control, needed to trigger data template changes in design tool 
            Look at CourseViewModelSampleData.xaml under SampleData/ to add and change the items
            It's a little bit messy how it gets the correct template. Hopefully the indicies won't change.
        -->
        <phone:Pivot Title="{Binding Path=LocalizedResources.ApplicationTitle, Source={StaticResource LocalizedStrings}}" Visibility="{Binding IsInDesignTool, Source={StaticResource DesignToolChecker}, Converter={StaticResource BooleanToVisibilityConverter}}">
            <phone:PivotItem Header="Front Page" Content="{Binding Contents,Converter={StaticResource EnumerableIndexConverter},ConverterParameter=0}" ContentTemplate="{Binding Source={StaticResource ViewModelTemplates},Path=Values[4]}" />
            <phone:PivotItem Header="Overview" Content="{Binding Contents,Converter={StaticResource EnumerableIndexConverter},ConverterParameter=1}" ContentTemplate="{Binding Source={StaticResource ViewModelTemplates},Path=Values[3]}" />
            <phone:PivotItem Header="News" Content="{Binding Contents,Converter={StaticResource EnumerableIndexConverter},ConverterParameter=2}" ContentTemplate="{Binding Source={StaticResource ViewModelTemplates},Path=Values[2]}" />
            <phone:PivotItem Header="Lectures" Content="{Binding Contents,Converter={StaticResource EnumerableIndexConverter},ConverterParameter=3}" ContentTemplate="{Binding Source={StaticResource ViewModelTemplates},Path=Values[1]}" />
            <phone:PivotItem Header="Exercises" Content="{Binding Contents,Converter={StaticResource EnumerableIndexConverter},ConverterParameter=4}" ContentTemplate="{Binding Source={StaticResource ViewModelTemplates},Path=Values[0]}" />
        </phone:Pivot>
    </Grid>    
</phone:PhoneApplicationPage>